# ๐ ูููุฐุฌ ุงูุตูุงุญูุงุช (Permissions Model)

## ๐ **ูุธุฑุฉ ุนุงูุฉ**

ุชู ุชุญุฏูุซ ูููุฐุฌ ุงูุตูุงุญูุงุช ูู ุงููุดุฑูุน ูููุชุฒู ุจุงูููุงุนุฏ ุงูุชุงููุฉ:

---

## ๐ฅ **ุงูุฃุฏูุงุฑ (Roles)**

### 1๏ธโฃ **admin (ุงููุงูู) - GOD MODE** 

#### ุงูุตูุงุญูุงุช:
- โ **ุชุญูู ูุงูู ุจุงููุธุงู:**
  - ุชุญุฏูุฏ ูููุฉ ุงูููุงุท
  - ุชุญุฏูุฏ ูููุฒุงุช ุงูุจุงูุงุช
  - ุชุญุฏูุฏ ุฃุณุนุงุฑ ุงูุจุงูุงุช
  
- โ **ูู ููุญุฉ ุงูุชุญูู (ููุจ ูุงุญูุงู):**
  - ุชุดุบูู/ุฅููุงู/ุชุนุฏูู ุฃู ูุชุฌุฑ
  - ุชุดุบูู/ุฅููุงู ุฃู ููุฒุฉ
  - ุชุดุบูู/ุฅููุงู ุฃู ุจุงูุฉ
  - ุชูุนูู/ุชุนุทูู ุฃู ุญุณุงุจ

- โ **ุตูุงุญูุงุช ูุงููุฉ ุนูู:**
  - ุฌููุน ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  - ุฌููุน ุงูุฅุฌุฑุงุกุงุช (ุงูุดุฑุงุกุ ุงูุชุนูููุ ุงูุชููููุ ุฅูุฎ)

#### ูู ุงูููุฏ:
```dart
// Admin ููููู ูุนู ูู ุดูุก
if (role == 'admin') {
  // GOD MODE - ุตูุงุญูุงุช ูุงููุฉ
}
```

---

### 2๏ธโฃ **merchant (ุงูุชุงุฌุฑ)**

#### ุงูุตูุงุญูุงุช:
- โ **ููุญุฉ ุชุญูู ููุจุงูููุฉ:**
  - ุฅุฏุงุฑุฉ ุงููุชุฌุฑ ุจุงููุงูู
  - ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู ููุชุฌุงุช
  - ุฅุถุงูุฉ/ุชุนุฏูู ุฅุนูุงูุงุช
  
- โ **ูุญูุธุฉ ุชุงุฌุฑ ูููุตูุฉ:**
  - ุฑุตูุฏ ุฎุงุต ุจุงูุชุงุฌุฑ
  - ูุดุฑุงุก ุงูููุฒุงุช ูุงูุจุงูุงุช
  
- โ **ููุงุท ุชุงุฌุฑ ูููุตูุฉ:**
  - ููุงุท ุฎุงุตุฉ ุจุงูุชุงุฌุฑ
  - ูุชูุนูู ููุฒุงุช ูุฏููุนุฉ (Boost, Highlight)
  
- โ **ููุฒุงุช ุฅุถุงููุฉ:**
  - ูุญุงุฏุซุงุช ูุน ุงูุนููุงุก
  - ูุชุงุจุนูู
  - ุชููููุงุช ููุฑุงุฌุนุงุช ุนูู ุงููุชุฌุฑ

#### โ๏ธ **ุงููููุฏ - Viewer Mode:**

ุนูุฏ ุงูุงูุชูุงู ูู ููุญุฉ ุงูุชุญูู ุฅูู ูุงุฌูุฉ ุงูุชุทุจูู (Customer UI):
- ุงูุชุงุฌุฑ ูููู ูู **"ูุถุน ุงูุชุตูุญ ููุท"** (Viewer Mode)

**ูุง ููุณูุญ ูู:**
- โ ุงูุดุฑุงุก ูู ุงููุชุงุฌุฑ
- โ ุฅุถุงูุฉ ููุชุฌุงุช ุฅูู ุงูุณูุฉ
- โ ุงุณุชุฎุฏุงู ุงูููุจููุงุช ูุนููู
- โ ุงุณุชุฎุฏุงู ููุงุท ุงูุนููู
- โ ุฅุถุงูุฉ ุชุนูููุงุช ุนูู ุงูููุชุฌุงุช
- โ ุฅุถุงูุฉ ุชููููุงุช ุฃู ูุฑุงุฌุนุงุช ุนูู ุงูููุชุฌุงุช

**ููุณูุญ ูู ููุท:**
- โ ุงุณุชูุดุงู ุงููุชุงุฌุฑ
- โ ุฑุคูุฉ ุงูููุชุฌุงุช
- โ ุฑุคูุฉ ุชุฌุฑุจุฉ ุงูุนููู ุจุฏูู ุฅุฌุฑุงุกุงุช ุดุฑุงุก

#### ููุงุญุธุฉ ูููุฉ:
> ุงูุณูุฉ ุงูุฎุงุตุฉ ุจุงูุชุงุฌุฑ (ุฅู ููุฌุฏุช) ุชููู **ุฏุงุฎู ููุญุฉ ุงูุชุญูู** ููุท ูุดุฑุงุก:
> - ููุฒุงุช (Features)
> - ููุงุท (Points)
> - ุจุงูุงุช (Packages)
> 
> ูููุณุช ุณูุฉ ุนููู ุฏุงุฎู ูุงุฌูุฉ ุงููุชุงุฌุฑ ุงูุนุงูุฉ.

#### ูู ุงูููุฏ:
```dart
// ุงูุชุญูู ูู Viewer Mode
if (role == 'merchant') {
  // Viewer Mode ููุท
  // ุฅุฎูุงุก/ุชุนุทูู: ุฅุถุงูุฉ ููุณูุฉุ ุดุฑุงุกุ ุชุนูููุ ุชูููู
}
```

---

### 3๏ธโฃ **customer (ุงูุนููู)**

#### ุงูุตูุงุญูุงุช:
- โ **ุงูุชุตูุญ ูุงูุงุณุชูุดุงู:**
  - ุชุตูุญ ุงููุชุงุฌุฑ
  - ุงุณุชูุดุงู ุงูููุชุฌุงุช
  
- โ **ุงูุณูุฉ ูุงูุทูุจุงุช:**
  - ุฅุฏุงุฑุฉ ุณูุฉ ูุงุญุฏุฉ ุฃู ุณูุฉ ูุดุชุฑูุฉ
  - ุฅุถุงูุฉ/ุฅูุบุงุก/ุฒูุงุฏุฉ/ุชูููุต ุงูููุชุฌุงุช
  - ูุดุงุฑูุฉ ุงูุณูุฉ ูุน ุฃุดุฎุงุต ุขุฎุฑูู
  - ุฅูุดุงุก ุทูุจุงุช
  
- โ **ุงูุฏูุน ูุงููุชุงุจุนุฉ:**
  - ุงูุฏูุน
  - ุชูุณูู ุงููุจูุบ ุนูู ุฃูุซุฑ ูู ุดุฎุต
  - ูุชุงุจุนุฉ ุญุงูุฉ ุงูุดุญูุฉ
  - ุชุฃููุฏ ุงูุงุณุชูุงู
  
- โ **ุงูุชูุงุนู:**
  - ุงูุชุนููู ุนูู ุงูููุชุฌุงุช **ุงูุชู ุงุดุชุฑุงูุง ููุท**
  - ุงูุชูููู ุนูู ุงูููุชุฌุงุช **ุงูุชู ุงุดุชุฑุงูุง ููุท**
  - ุฅุถุงูุฉ ูุฑุงุฌุนุงุช ุนูู ุงูููุชุฌุงุช **ุงูุชู ุงุดุชุฑุงูุง ููุท**
  
- โ **ุงููุญูุธุฉ ูุงูููุงุท:**
  - ูุญูุธุฉ ุนููู ุฎุงุตุฉ
  - ููุงุท ุนููู ุฎุงุตุฉ
  - ุงุณุชุฎุฏุงู ุงูููุจููุงุช
  
- โ **ุงูุญุณุงุจ:**
  - ุชุนุฏูู ุงูุจูุงูุงุช ุงูุดุฎุตูุฉ

#### ูู ุงูููุฏ:
```dart
// ุงูุนููู ููููู ูุนู ูู ุดูุก
if (role == 'customer') {
  // ุชูุนูู ูู ุงูุฃุฒุฑุงุฑ ูุงูููุฒุงุช
}
```

---

## ๐ง **ุงูุชุทุจูู ูู ุงูููุฏ**

### **ููู `permissions_helper.dart`:**

```dart
/// ุงูุฏูุงู ุงููุชุงุญุฉ:

// ุฌูุจ ุงูุฏูุฑ ุงูุญุงูู
static Future<String?> getCurrentUserRole()

// ุตูุงุญูุงุช ุงูุณูุฉ ูุงูุทูุจุงุช
static Future<bool> canAddToCart()         // customer ุฃู admin ููุท
static Future<bool> canCreateOrder()       // customer ุฃู admin ููุท

// ุตูุงุญูุงุช ุงูุชูุงุนู
static Future<bool> canAddReviews()        // customer ุฃู admin ููุท
static Future<bool> canUseCoupons()        // customer ุฃู admin ููุท
static Future<bool> canUseCustomerPoints() // customer ุฃู admin ููุท

// ุงูุชุญูู ูู ุงูุฃุฏูุงุฑ
static Future<bool> isViewerMode()         // merchant ูู ูุงุฌูุฉ ุงูุนููู
static Future<bool> isAdmin()              // admin
static Future<bool> isCustomer()           // customer
static Future<bool> isMerchant()           // merchant

// ุฑุณุงุฆู ุชูุถูุญูุฉ
static Future<String> getViewerModeMessage()
```

---

## ๐ **ุงููููุงุช ุงูููุญุฏูุซุฉ**

### 1. **`lib/core/permissions_helper.dart`**
- โ ุฅุถุงูุฉ ุชูุซูู ุดุงูู ููู ุฏูุฑ
- โ ุฅุถุงูุฉ ุฏูุงู ุฌุฏูุฏุฉ: `canUseCoupons()`, `canUseCustomerPoints()`
- โ ุฅุถุงูุฉ ุฏูุงู ูุณุงุนุฏุฉ: `isCustomer()`, `isMerchant()`, `getViewerModeMessage()`
- โ ุชุญุฏูุซ ุฌููุน ุงูุฏูุงู ูุชุดูู `admin` ูู ุงูุตูุงุญูุงุช

### 2. **`lib/features/customer/presentation/screens/home_screen.dart`**
- โ ุฅุถุงูุฉ ุดุฑูุท ุชุญุฐูุฑู ููุชุงุฌุฑ ูู ูุถุน Viewer Mode
- โ ุงูุดุฑูุท ูุธูุฑ ุฃุนูู ุงูุดุงุดุฉ: "ูุถุน ุงูุชุตูุญ ููุท - ูุง ูููู ุงูุดุฑุงุก ุฃู ุฅุถุงูุฉ ููุณูุฉ"
- โ ุฒุฑ "ุฅุถุงูุฉ ุฅูู ุงูุณูุฉ" ูุฎูู ููุชุงุฌุฑ (ููุฌูุฏ ุจุงููุนู)

### 3. **`lib/features/customer/presentation/screens/explore_screen.dart`**
- โ ุฅุถุงูุฉ ุดุฑูุท ุชุญุฐูุฑู ููุชุงุฌุฑ ูู ูุถุน Viewer Mode
- โ ุฒุฑ "ุดุฑุงุก ุงูุขู" ูุนุทู ููุชุงุฌุฑ (ููุฌูุฏ ุจุงููุนู)

### 4. **`lib/features/customer/presentation/screens/cart_screen.dart`**
- โ ุดุงุดุฉ ูุงููุฉ ููุชุงุฌุฑ ุชูุถุญ ุฃูู ูู Viewer Mode (ููุฌูุฏุฉ ุจุงููุนู)
- โ ุฑุณุงูุฉ: "ูุถุน ุงูุชุตูุญ ููุท - ุงูุชุงุฌุฑ ูุง ููููู ุงุณุชุฎุฏุงู ุณูุฉ ุงูุนููู"

### 5. **`lib/features/customer/data/cart_service.dart`**
- โ ุฌููุน ุงูุฏูุงู ุชุชุญูู ูู `canAddToCart()` ูุจู ุงูุชูููุฐ (ููุฌูุฏ ุจุงููุนู)

### 6. **`lib/features/customer/data/order_service.dart`**
- โ ุงูุชุญูู ูู `canCreateOrder()` ูุจู ุฅูุดุงุก ุงูุทูุจ (ููุฌูุฏ ุจุงููุนู)

---

## โ **ูุง ุชู ุงูุชุฃูุฏ ููู**

### **ูู Flutter:**
- โ ุนูุฏ ุฌูุจ `user_profiles`:
  - ุฅุฐุง `role == 'customer'` โ ูุชุญ `CustomerShell` ูุน ุชูุนูู ูู ุงูุฃุฒุฑุงุฑ
  - ุฅุฐุง `role == 'merchant'` โ ูุชุญ `MerchantDashboard`
    - ุนูุฏ ุงูุฐูุงุจ ูู `CustomerShell`: ูุถุน **read-only**
      - ุฅุฎูุงุก/ุชุนุทูู ุฒุฑ "ุฅุถุงูุฉ ุฅูู ุงูุณูุฉ" โ
      - ุฅุฎูุงุก/ุชุนุทูู ุฒุฑ "ุดุฑุงุก ุงูุขู" โ
      - ุฅุฎูุงุก/ุชุนุทูู ุฃุฒุฑุงุฑ ุงูุชุนููู ูุงูุชูููู โ

### **ูู ุงูุฎุฏูุงุช (Services):**
- โ `CartService`: ูุชุญูู ูู `canAddToCart()` ูุจู ุฃู ุนูููุฉ
- โ `OrderService`: ูุชุญูู ูู `canCreateOrder()` ูุจู ุงูุฅูุดุงุก
- โ `CouponService`: ุณูุชู ุฅุถุงูุฉ ุงูุชุญูู ูุงุญูุงู

### **ุงูุฌุฏุงูู ุงููุญููุฉ:**
ุฌููุน ุงูุนูููุงุช ุนูู ูุฐู ุงูุฌุฏุงูู ูุญููุฉ ุจุดุฑูุท:
- โ `carts`
- โ `cart_items`
- โ `orders`
- โ `order_items`
- โณ `product_reviews` (ุณูุชู ุญูุงูุชูุง ูุงุญูุงู)
- โณ `ratings` (ุณูุชู ุญูุงูุชูุง ูุงุญูุงู)

---

## ๐ **ุงูุฎุทูุงุช ุงููุงุฏูุฉ**

### **ุงููุฑุญูุฉ ุงูุชุงููุฉ - RLS ูู Supabase:**

ุนูุฏ ุฅุถุงูุฉ Row Level Security ูุงุญูุงูุ ุณูุชู ุชุฑุฌูุฉ ูุฐู ุงูููุงุนุฏ ุฅูู ุณูุงุณุงุช ุฑุณููุฉ:

```sql
-- ูุซุงู: ุญูุงูุฉ ุฌุฏูู carts
CREATE POLICY "ุงูุนููุงุก ููุท ูููููู ุฑุคูุฉ ุณูุชูู" 
ON carts FOR SELECT 
USING (
  auth.uid() = user_id 
  AND 
  (SELECT role FROM user_profiles WHERE id = auth.uid()) = 'customer'
);

CREATE POLICY "ุงูุนููุงุก ููุท ูููููู ุฅุถุงูุฉ ููุณูุฉ" 
ON carts FOR INSERT 
WITH CHECK (
  auth.uid() = user_id 
  AND 
  (SELECT role FROM user_profiles WHERE id = auth.uid()) = 'customer'
);
```

---

## ๐ **ููุฎุต ุงูููุงุนุฏ**

| ุงูุฅุฌุฑุงุก | customer | merchant | admin |
|---------|----------|----------|-------|
| ุงูุชุตูุญ ูุงูุงุณุชูุดุงู | โ | โ | โ |
| ุฅุถุงูุฉ ููุณูุฉ | โ | โ | โ |
| ุฅูุดุงุก ุทูุจ | โ | โ | โ |
| ุงุณุชุฎุฏุงู ููุจููุงุช | โ | โ | โ |
| ุงุณุชุฎุฏุงู ููุงุท ุนููู | โ | โ | โ |
| ุชุนููู ูุชูููู | โ | โ | โ |
| ุฅุฏุงุฑุฉ ูุชุฌุฑ | โ | โ | โ |
| ููุงุท ุชุงุฌุฑ | โ | โ | โ |
| ูุญูุธุฉ ุชุงุฌุฑ | โ | โ | โ |
| ุตูุงุญูุงุช ุงููุธุงู | โ | โ | โ |

---

## โ๏ธ **ููุงุญุธุงุช ูููุฉ**

1. **ุญุงููุงู:** ูุนูู ุจุฏูู RLS - ุงูุญูุงูุฉ ูู ููุทู ุงูุชุทุจูู ููุท
2. **ูุณุชูุจูุงู:** ุณูุชู ุฅุถุงูุฉ RLS ูุทุจูุฉ ุญูุงูุฉ ุฅุถุงููุฉ
3. **ุงูุชุงุฌุฑ:** ูุง ููุชูู ุญุณุงุจ ุนููู - ููููู ุงูุชุตูุญ ููุท
4. **Admin:** ูู ุตูุงุญูุงุช ูุงููุฉ ููู ุบูุฑ ููุนูู ุญุงููุงู ูู UI

---

**ุขุฎุฑ ุชุญุฏูุซ:** 30 ููููุจุฑ 2025

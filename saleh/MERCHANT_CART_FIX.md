# ๐ง ุฅุตูุงุญ ูุดุงูู ุชุณุฌูู ุฏุฎูู ุงูุชุงุฌุฑ ูุงูุณูุฉ

**ุงูุชุงุฑูุฎ:** ุฏูุณูุจุฑ 2025

---

## ๐ ุงููุดุงูู ุงูููุชุดูุฉ

### 1. **ูุดููุฉ ูู ุงูุณูุฉ (Cart Service)**

#### ุงููุดููุฉ:
- ุงุณุชุฎุฏุงู `owner_id` ุจุฏูุงู ูู `user_id` ูู ุฌุฏูู `carts`
- ุฌุฏูู `carts` ูุณุชุฎุฏู `user_id` ูููุณ `owner_id`

#### ุงูุญู ุงููุทุจู:
```dart
// ูุจู (ุฎุทุฃ):
.eq('owner_id', user.id)
.eq('status', 'active')  // ูุง ููุฌุฏ ุนููุฏ status ูู carts

// ุจุนุฏ (ุตุญูุญ):
.eq('user_id', user.id)
```

#### ุงููููุงุช ุงููุนุฏูุฉ:
- โ `lib/features/customer/data/cart_service.dart`
  - ุงูุณุทุฑ 25: `owner_id` โ `user_id`
  - ุงูุณุทุฑ 37: `owner_id` โ `user_id` + ุฅุฒุงูุฉ `status`
  - ุงูุณุทุฑ 137: `owner_id` โ `user_id` + ุฅุฒุงูุฉ `status`

- โ `lib/features/customer/data/order_service.dart`
  - ุงูุณุทุฑ 38: `owner_id` โ `user_id` + ุฅุฒุงูุฉ `status`

---

### 2. **ูุดููุฉ ุชุณุฌูู ุฏุฎูู ุงูุชุงุฌุฑ**

#### ุงููุดููุฉ ุงููุญุชููุฉ:
- ุงูุชุงุฌุฑ ูุฏ ูุง ูุชู ุงูุชุนุฑู ุนููู ุจุดูู ุตุญูุญ
- ูุฏ ุชููู ุงููุดููุฉ ูู `root_widget.dart` ุนูุฏ ุฌูุจ role

#### ุงูุญู:
- โ ุชู ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูู `auth_service.dart`
- โ ุชู ุฅุถุงูุฉ ูุนูููุงุช Debug ุฃูุซุฑ
- โ ุชู ุชุญุณูู ุงูุชุญูู ูู role ูู `root_widget.dart`

---

## ๐ ุจููุฉ ุฌุฏูู `carts`

```sql
CREATE TABLE IF NOT EXISTS carts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES user_profiles(id) ON DELETE CASCADE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(user_id)  -- ูู ูุณุชุฎุฏู ูู ุณูุฉ ูุงุญุฏุฉ ููุท
);
```

**ููุงุญุธุงุช:**
- โ ูุณุชุฎุฏู `user_id` ูููุณ `owner_id`
- โ ูุง ููุฌุฏ ุนููุฏ `status` - ุงูุณูุฉ ุฏุงุฆูุงู ูุดุทุฉ
- โ `UNIQUE(user_id)` - ูู ูุณุชุฎุฏู ูู ุณูุฉ ูุงุญุฏุฉ ููุท

---

## ๐ง ุงูุชุญุณููุงุช ุงููุทุจูุฉ

### 1. **ุฅุตูุงุญ Cart Service:**
- โ ุงุณุชุฎุฏุงู `user_id` ุจุฏูุงู ูู `owner_id`
- โ ุฅุฒุงูุฉ `.eq('status', 'active')` (ูุง ููุฌุฏ ุนููุฏ status)
- โ ุชุจุณูุท ุงูุงุณุชุนูุงูุงุช

### 2. **ุฅุตูุงุญ Order Service:**
- โ ุงุณุชุฎุฏุงู `user_id` ุจุฏูุงู ูู `owner_id`
- โ ุฅุฒุงูุฉ `.eq('status', 'active')`

### 3. **ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก:**
- โ ุฑุณุงุฆู ุฎุทุฃ ุฃูุถุญ
- โ ูุนูููุงุช Debug ุฃูุซุฑ

---

## โ ุงููุชูุฌุฉ

### ูุจู ุงูุฅุตูุงุญ:
- โ ุงูุณูุฉ ูุง ุชุนูู (ุฎุทุฃ ูู ุงูุจุญุซ)
- โ Order Service ูุง ูุนูู (ุฎุทุฃ ูู ุงูุจุญุซ)

### ุจุนุฏ ุงูุฅุตูุงุญ:
- โ ุงูุณูุฉ ุชุนูู ุจุดูู ุตุญูุญ
- โ Order Service ูุนูู ุจุดูู ุตุญูุญ
- โ ุชุณุฌูู ุฏุฎูู ุงูุชุงุฌุฑ ูุญุณูู

---

## ๐ฏ ุงุฎุชุจุงุฑ ุงูุญู

### 1. **ุงุฎุชุจุงุฑ ุงูุณูุฉ:**
```dart
// ูุฌุจ ุฃู ูุนูู ุงูุขู:
final cartId = await CartService.getOrCreateActiveCart();
await CartService.addToCart(productId);
final items = await CartService.getCartItems();
```

### 2. **ุงุฎุชุจุงุฑ ุชุณุฌูู ุฏุฎูู ุงูุชุงุฌุฑ:**
- โ ุชุณุฌูู ุฏุฎูู ุจุญุณุงุจ role = 'merchant'
- โ ุงูุชุญูู ูู ุธููุฑ MerchantHomeScreen
- โ ุงูุชุญูู ูู ุนุฏู ุงููุฏุฑุฉ ุนูู ุฅุถุงูุฉ ููุณูุฉ (Viewer Mode)

---

## ๐ ููุงุญุธุงุช ูููุฉ

### 1. **ุงููุฑู ุจูู `user_id` ู `owner_id`:**
- `user_id`: ูุณุชุฎุฏู ูู `carts`, `favorites`, `orders` (customer)
- `owner_id`: ูุณุชุฎุฏู ูู `stores`, `wallets` (merchant/customer)

### 2. **Viewer Mode ููุชุงุฌุฑ:**
- ุงูุชุงุฌุฑ ูู ูุงุฌูุฉ ุงูุนููู ูููู ูู "Viewer Mode"
- ูุง ููููู ุฅุถุงูุฉ ููุณูุฉ ุฃู ุงูุดุฑุงุก
- ููููู ููุท ุงูุชุตูุญ

---

**ุขุฎุฑ ุชุญุฏูุซ:** ุฏูุณูุจุฑ 2025  
**ุงูุญุงูุฉ:** โ ุชู ุงูุฅุตูุงุญ


# Architecture_decisions.md
## Mbuy – Architectural Decisions & Non-Negotiables

هذا الملف هو المرجع الرسمي لقرارات البنية المعمارية في مشروع Mbuy.
الهدف منه:
- توثيق *لماذا* تم اتخاذ القرارات الأساسية
- منع إعادة النقاش حول قرارات محسومة
- إيقاف أي “تحسينات ذكية” تخالف فلسفة المشروع

أي تعارض بين هذا الملف وأي اقتراح أو تنفيذ = الالتزام بهذا الملف أو طلب موافقة صريحة قبل المتابعة.

---

## 1. مبدأ الوسيط الواحد (Single Mediator Principle)

### القرار
جميع عمليات التواصل بين الواجهة (Flutter) والبيانات أو المنطق الخلفي تمر عبر وسيط واحد فقط.

### السبب
- فصل تام بين العرض والمنطق
- منع تسرب الصلاحيات أو المفاتيح
- توحيد التحكم في:
  - الصلاحيات
  - التسعير
  - التحقق
  - المنطق التجاري

### ما يُمنع
- أي ربط مباشر من Flutter لأي مصدر بيانات
- أي منطق تجاري داخل الواجهة

هذا القرار **نهائي وغير قابل للنقاش**.

---

## 2. منع الازدواجية المعمارية

### القرار
لا يُسمح بوجود أكثر من طريق يؤدي لنفس النتيجة.

### السبب
- الازدواجية = فوضى مستقبلية
- صعوبة الصيانة
- تضارب في السلوك

### أمثلة ممنوعة
- مسارين مختلفين لجلب نفس البيانات
- منطق مكرر في أكثر من طبقة
- معالجة جزئية في الواجهة وجزئية في الوسيط

---

## 3. الواجهة = عرض فقط (UI Is Passive)

### القرار
الواجهة لا تفكر، لا تقرر، لا تتحقق.

### السبب
- سهولة الاختبار
- وضوح السلوك
- منع الأخطاء غير المتوقعة

### ما يُسمح به في الواجهة
- عرض بيانات
- التقاط تفاعل المستخدم
- إرسال الطلبات فقط

### ما يُمنع
- شروط تجارية
- حساب أسعار
- تحديد صلاحيات
- اتخاذ قرارات

---

## 4. القرارات التجارية خارج الواجهة

### القرار
أي شيء يؤثر على:
- السعر
- النقاط
- الصلاحيات
- الترتيب
- الظهور

يُتخذ خارج الواجهة.

### السبب
- قابلية التعديل بدون تحديث التطبيق
- تحكم مركزي
- حماية من التلاعب

---

## 5. الوثائق تسبق الكود

### القرار
لا يُكتب كود يعكس قرارًا غير موثّق.

### السبب
- الكود يتغير
- الوثائق تحفظ النية

### القاعدة
أي قرار جديد:
1) يُناقش
2) يُوثق
3) ثم يُنفّذ

---

## 6. الحظر الافتراضي للتقنيات والأنماط

### القرار
أي تقنية، نمط، مكتبة، أو أسلوب غير مذكور في `mbuy-docs`:
- يعتبر ممنوع افتراضيًا

### السبب
- منع التضخم التقني
- الحفاظ على بساطة النظام
- سهولة التوسّع المدروس

الإضافة لا تتم إلا بطلب صريح أو موافقة مسبقة.

---

## 7. لا تغييرات ضمنية (No Silent Changes)

### القرار
أي تغيير خارج نطاق الطلب الصريح:
- يجب إيقاف التنفيذ
- وطلب توضيح

### السبب
- التغييرات الضمنية أخطر من الأخطاء
- تكسر الافتراضات السابقة

---

## 8. التنظيف جزء من أي تعديل

### القرار
أي تعديل معتمد يجب أن يتبعه:
- حذف كل ما لم يعد مستخدمًا
- إزالة أي مسار أو ملف ميت

### السبب
- المشروع طويل العمر
- التراكم = عبء

ترك مخلفات يُعد فشل تنفيذ.

---

## 9. الاستقرار أهم من “الأفضل”

### القرار
لا يتم تغيير بنية مستقرة لأنها:
- “أجمل”
- “أنظف”
- “أفضل ممارسة”

إلا إذا:
- هناك مشكلة حقيقية
- أو طلب صريح

### السبب
- الاستقرار قيمة أساسية
- التحسين غير المطلوب مخاطرة

---

## 10. هذا الملف مرجع حاكم

### القرار
هذا الملف:
- لا يُتجاوز
- لا يُفسَّر باجتهاد
- لا يُعدل إلا بموافقة صريحة

أي Agent أو مطوّر يخالفه:
- يوقف التنفيذ
- ويطلب توجيه

---

## الخلاصة النهائية

> Mbuy ليس مشروعًا تجريبيًا.
> هو نظام طويل العمر، مركزي التحكم، قليل الاجتهاد، عالي الوضوح.

الالتزام بهذه القرارات شرط أساسي للاستمرار في التطوير.